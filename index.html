<!DOCTYPE HTML> 
<html>
<head>
<meta charset="UTF-8">

<title>Insert title here</title>

<!-- <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"> -->
<!-- <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script> -->
<!-- <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script> -->

<script src="lib/Healpix/Xyf.js"></script>
<script src="lib/Healpix/Vec3.js"></script>
<script src="lib/Healpix/Pointing.js"></script> 
<script src="lib/Healpix/Hploc.js"></script>
<script src="lib/Healpix/Fxyf.js"></script>
<script src="lib/Healpix/Healpix.js"></script> 

<script src="lib/utils/webgl-debug.js"></script>

<script src="lib/glMatrix/glMatrix.js"></script>

<script src="FabViewer.js"></script>
<script src="Model.js"></script>
<script id="shader-vs" type="x-shader/x-vertex">
	attribute vec3 aVertexPosition;
	attribute vec2 aTextureCoordinates;
	//uniform float aFactor0;
	//uniform float aFactor1;

	uniform mat4 uMVMatrix;
	uniform mat4 uPMatrix;
  
  	varying vec2 vTextureCoordinates;
	//varying float vFactor0;
	//varying float vFactor1;

	void main() {
		gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
		vTextureCoordinates = aTextureCoordinates;
		//vFactor0 = aFactor0;
		//vFactor1 = aFactor1;
	}
</script>

<script id="shader-fs" type="x-shader/x-fragment">
  	precision mediump float;
  
	varying vec2 vTextureCoordinates;
	uniform sampler2D uSampler0;
	uniform sampler2D uSampler1;
	uniform sampler2D uSampler2;
	uniform float uFactor0;
	uniform float uFactor1;
	uniform float uFactor2;

  	void main() {
		//float tex0Active = 0.0;
		//float tex1Active = 0.0;
		//float tex2Active = 0.0;

		vec3 finalColor;

		//vec4 color0 = vec4(0.0, 0.0, 0.0, 0.0);
		//vec3 finalColor0 = vec3(color0.x/uFactor0, color0.y/uFactor0, color0.z /uFactor0);
		if (uFactor0 >= 0.0){
			//tex0Active = 1.0;
			vec4 color0 = texture2D(uSampler0, vTextureCoordinates);
			finalColor = vec3(finalColor.x +  color0.x *uFactor0 ,finalColor.y +  color0.y*uFactor0,finalColor.z +  color0.z*uFactor0); 
			//finalColor0 = vec3(color0.x/uFactor0, color0.y/uFactor0, color0.z /uFactor0);
		}
		 

		//vec4 color1 = vec4(0.0, 0.0, 0.0, 0.0);
		//vec3 finalColor1 = vec3(color1.x/uFactor1, color1.y/uFactor1, color1.z /uFactor1);
		if (uFactor1 >= 0.0){
			//tex1Active = 1.0;
			vec4 color1 = texture2D(uSampler1, vTextureCoordinates);
			finalColor = vec3(finalColor.x +  color1.x*uFactor1,finalColor.y +  color1.y*uFactor1,finalColor.z +  color1.z*uFactor1);
			//finalColor1 = vec3(color1.x/uFactor1, color1.y/uFactor1, color1.z /uFactor1);
		}

		// vec4 color2 = vec4(0.0, 0.0, 0.0, 0.0);
		//vec3 finalColor2 = vec3(color2.x/uFactor2, color2.y/uFactor2, color2.z /uFactor2);
		if (uFactor2 >= 0.0){
			//tex2Active = 1.0;
			vec4 color2 = texture2D(uSampler2, vTextureCoordinates);
			finalColor = vec3(finalColor.x +  color2.x*uFactor2,finalColor.y +  color2.y*uFactor2,finalColor.z +  color2.z*uFactor2);
		}
		gl_FragColor = vec4(finalColor, 1);		

		
		//gl_FragColor = mix(color0, color1, 0.5);
		//gl_FragColor = mix(vec4(finalColor0, 1), vec4(finalColor1, 1), 0.5);
		//gl_FragColor = color0 * 1.0 * tex0Active + color1 * 1.0 * tex1Active;
		
  	} 
</script>



<body >
<!-- <body onload="startup();"> -->

<script type="text/javascript">
window.onload = function(){
	var skiesDiv = document.getElementById("skies");
// 	console.log(skies);
// 	console.log(skies.length);
// 	console.log(skies[0].name);
	for (var i=0; i<skies.length; i++){
		var checkbox = document.createElement('input');
		checkbox.type = "checkbox";
		checkbox.name = "hips";
		checkbox.value = skies[i].index;
		checkbox.id = "hips"+skies[i].index;
		if (skies[i].index == pwgl.defaultMapId){
			checkbox.checked = true;
		}
		
		var label = document.createElement('label')
		label.htmlFor = checkbox.id;
		label.appendChild(document.createTextNode(skies[i].name));

		
		var range = document.createElement('input');
		range.type = "range";
		range.name = "transparency";
		range.id = skies[i].index;
		range.value = "100";
		range.min = "0";
		range.max = "100";
		
		skiesDiv.appendChild(checkbox);
		skiesDiv.appendChild(label);
		skiesDiv.appendChild(range);

		skiesDiv.appendChild(document.createElement("br"));

		document.getElementById(checkbox.id).addEventListener("click", function(){
			if (this.checked){
// 				console.log(this);	
				addSky(this.value);
			}else{
				removeSky(this.value);
			}
		});
		
		document.getElementById(range.id).addEventListener("change", function(){
// 			console.log(this.value);
			changeSkyTransparency(this.id, this.value);
		});
	}

	startup();
}
</script>
	<div id='container' style="border: 1px solid black;" ></div>
	
  	<div id='controls' style="z-index: 10; position: absolute; color: blue; width: 400px; right: 10px; ">
	  	<div id="coords">
	  		coords: --
	  	</div>
	  	<div id="coordsHMS">
	  		coordsHMS: --
	  	</div>
	  	<div id="fov">
	  		fov: --
	  	</div>
	  	
	  	<div id="skies"></div>
  	</div>
  	
</body>
</html>

